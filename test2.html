<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/velocity/1.2.1/velocity.js" type="text/javascript"></script>
    <script src="library/timedani.js" type="text/javascript"></script>
    <script type="text/javascript">
        $(function() {

            //we define a new TAAnimation class for repeated animations
            //TAAnimation Interface requires only a start() method that takes
            //an TAObject and a callback as parameter

            //every object that has a start() method with this signature is an Animation object
            //this allows for pretty easy animations
            //keep in mind: this MyRepeatAnimation repeats ANY animation, even other MyRepeatAnimations ;)

            //BEWARE: this object is pretty dumb and can't be shared between multiple objects
            //you'll need to encapsulate this.count for this to work

            //an animation object should not have mutable state!
            //see how TAChainedAnimation handles this with function local data

            function MyRepeatAnimation(times, animation) {

                this.count = 0;

                this.start = function(obj, complete) {
                    if(this.count >= times) {
                        this.count = 0;
                        //watch out: complete might be NULL
                        if(complete) complete(this);
                        return;
                    }
                    ++this.count;
                    var that = this;
                    animation.start(obj, function() {
                        that.start(obj, complete);
                    });
                };
            }


            //we animated relative to current position
            var stepRightAnimation = new TAApp.TAVelocityAnimation(
                    {left:"+=50px"},{duration:500}
            );

            var stepUpAnimation = new TAApp.TAVelocityAnimation(
                    {top:"-=50px"},{duration:500}
            );

            //we create a fancy animation object
            //TAChainedAnimation just executes animations after each other
            //and our MyRepeatAnimation repeats this chain now
            //switch TAChainedAnimation with TAParallelAnimation to see a diagonal move instead of a steps-like move
            //don't forget to add queue:false to the animation options
            var box = new TAApp.TAObject(
                    "box",
                    $("#box"),
                    {
                        inAni: new MyRepeatAnimation(6, new TAApp.TAChainedAnimation([stepRightAnimation, stepUpAnimation]))
                    },
                    new TAApp.TACssSettings({top:"250px", left:"0px", display:"inline"})
            );


            //we don't loop this animation, we just start it on button press
            //we ignore box:out because we don't use it
            //you can fire app.start("box:out) and it would trigger "box:out" instantly
            //but we skip this here because it is not needed.

            var $button = $("#button");
            var app = TAApp.TAApp;

            //button clicked, disable button and start animation
            $button.click(function() {
                $button.prop("disabled", true);
                app.start("box:in");
            });

            //animation finished, enable button
            app.on("box:in", function() {
                $button.prop("disabled", false);
            });

            console.log("Keep in mind that all this happens asynchronously");

            //for the curious, a looping timeline would look like this:
            /*
            var tl = new TAApp.TATimeline("timeline");
            var d = tl.getDescriber();

            tl.add([
                d.startAndWaitFor("box:in"),
                d.startAndWaitFor("box:out"),
                d.loop(),
            ]);
            tl.go();
            */
        });
    </script>

    <style type="text/css">
        #content {
            overflow:hidden;
            position: absolute;
            left: 80px;
            top: 40px;
            border-color: red;
            border-style: solid;
            border-width: 2px;
            background-color: lightgoldenrodyellow;
            width: 300px;
            height: 300px;
        }

        .fullwidth {
            width: 300px;
        }

        .box {
            width: 75px;
            height: 75px;
            background-color: blue;
            position: absolute;
            display: none;
        }


        #button {
            position:absolute;
            top: 40px;
            left: 400px;
        }
    </style>
</head>
<body>
<div id="content">

    <span id="box" class="box"></span>
</div>

<input type="button" id="button" value="Start Animation" />

<!-- we need a taapp element! -->
<div id="taapp"></div>
</body>
</html>